--Crear usuario
--ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE; 
--CREATE USER fundamentos IDENTIFIED by fundamentos
--DATA_LENGTHEFAULT TABLESPACE users
--TEMPORARY TABLESPACE temp;
--GRANT CONNECT, RESOURCE TO fundamentos;
--GRANT UNLIMITED TABLESPACE TO fundamentos;

--Ajustes de sistema
set linesize 300
set pagesize 50
set feddback on
set colsep ' ||' 
set null s/dato
clear screen
spool C:\Users\melis\OneDrive\Escritorio\Lots.txt
--Cambiar idioma 
ALTER SESSION SET NLS_DATE_LANGUAGE  = 'ENGLISH';

--Borrar tablas
DROP TABLE LOTS1A CASCADE CONSTRAINTS;
DROP TABLE LOTS1B CASCADE CONSTRAINTS;
DROP TABLE LOTS2 CASCADE CONSTRAINTS;

--Crear tablas

CREATE TABLE LOTS1A(
    PROPERTY_ID# VARCHAR2(7) NOT NULL,
    COUNTRY_NAME VARCHAR2(10) NOT NULL,
    LOT# NUMBER(3) NOT NULL,
    AREA NUMBER(5,2) NOT NULL
);

CREATE TABLE LOTS1B(
    AREA NUMBER(5,2) NOT NULL,
    PRICE NUMBER(7) NOT NULL
);

CREATE TABLE LOTS2(
    COUNTRY_NAME VARCHAR2(15) NOT NULL,
    TAX_RATE NUMBER(3,2) NOT NULL
);

--Restricciones PK
ALTER TABLE LOTS1A ADD CONSTRAINT PK_LOTS1A PRIMARY KEY (PROPERTY_ID#);
ALTER TABLE LOTS1B ADD CONSTRAINT PK_LOTS1B PRIMARY KEY (AREA);
ALTER TABLE LOTS2 ADD CONSTRAINT PK_LOTS2 PRIMARY KEY (COUNTRY_NAME);

--Restricciones FK
ALTER TABLE LOTS1A ADD CONSTRAINT FK_LOTS1A_LOTS2_COUNTRY FOREIGN KEY (COUNTRY_NAME) REFERENCES LOTS2(COUNTRY_NAME);
ALTER TABLE LOTS1A ADD CONSTRAINT FK_LOTS1A_LOTS1B_AREA FOREIGN KEY (AREA) REFERENCES LOTS1B(AREA);


INSERT INTO LOTS1B VALUES (100.3,295000);
INSERT INTO LOTS1B VALUES (210.3,395000);
INSERT INTO LOTS1B VALUES (350.4,495000);
INSERT INTO LOTS1B VALUES (410.3,595000);
INSERT INTO LOTS1B VALUES (320.32,695000);
INSERT INTO LOTS1B VALUES (420.2,1095000);
INSERT INTO LOTS1B VALUES (400.51,895000);
INSERT INTO LOTS1B VALUES (310.15,995000);
INSERT INTO LOTS1B VALUES (218.4,328000);
--Violar precision
INSERT INTO LOTS1B VALUES (123.216,11950000);

INSERT INTO LOTS2 VALUES ('Spain',0.21);
INSERT INTO LOTS2 VALUES ('France',0.20);
INSERT INTO LOTS2 VALUES ('Italy',0.22);
INSERT INTO LOTS2 VALUES ('Germany',0.19);
INSERT INTO LOTS2 VALUES ('Portugal',0.23);
INSERT INTO LOTS2 VALUES ('Greece',0.24);
INSERT INTO LOTS2 VALUES ('Belgium',0.18);
INSERT INTO LOTS2 VALUES ('Netherlands',0.17);



--Insertar datos
INSERT INTO LOTS1A VALUES ('123-456','Spain',121,100.3);
INSERT INTO LOTS1A VALUES ('123-457','France',122,210.3);
INSERT INTO LOTS1A VALUES ('123-458','Italy',123,350.4);
INSERT INTO LOTS1A VALUES ('123-459','Germany',124,410.3);
INSERT INTO LOTS1A VALUES ('123-460','Portugal',125,320.32);
INSERT INTO LOTS1A VALUES ('123-461','Greece',126,420.2);
INSERT INTO LOTS1A VALUES ('123-462','Belgium',127,400.51);
INSERT INTO LOTS1A VALUES ('123-463','Netherlands',128,310.15);
INSERT INTO LOTS1A VALUES ('123-464','Spain',129,218.4);
--Violar precision
INSERT INTO LOTS1A VALUES ('123-465','Spain',130,123.216);

--Consultas

--1. Listar todos los lotes de España y su precio
SELECT LOTS1A.PROPERTY_ID#, LOTS1A.COUNTRY_NAME, LOTS1A.LOT#, LOTS1A.AREA, LOTS1B.PRICE
FROM LOTS1A, LOTS1B
WHERE LOTS1A.COUNTRY_NAME = 'Spain' AND LOTS1A.AREA = LOTS1B.AREA;

--2. Listar todos los lotes de España y su precio, ordenados por precio
SELECT LOTS1A.PROPERTY_ID#, LOTS1A.COUNTRY_NAME, LOTS1A.LOT#, LOTS1A.AREA, LOTS1B.PRICE
FROM LOTS1A, LOTS1B
WHERE LOTS1A.COUNTRY_NAME = 'Spain' AND LOTS1A.AREA = LOTS1B.AREA
ORDER BY LOTS1B.PRICE;

--DESPLEGAR TABLAS

--Tabla LOTS1A
SELECT * FROM LOTS1A;

--Tabla LOTS1B
SELECT * FROM LOTS1B;

--Tabla LOTS2
SELECT * FROM LOTS2;



--Columnas de usuario
COL TABLE_NAME FORMAT A15
COL DATA_TYPE  FORMAT A15
COL DATA_SCALE FORMAT 999.99
COL NULLABLE   FORMAT A2
SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH,
	DATA_PRECISION,DATA_SCALE,NULLABLE
	FROM USER_TAB_COLUMNS 
	WHERE TABLE_NAME IN ( 'LOTS1A','LOTS1B','LOTS2')
	ORDER BY 1,2;

--Mostrar Restricciones
prompt USER CONSTRAINTS
COLUMN CONSTRAINT_NAME FORMAT A27
column table_name format a12
column owner format a9
select owner,table_name,constraint_name,constraint_type,
	deferrable,deferred
	from user_constraints
	where table_name IN ( 'LOTS1A','LOTS1B','LOTS2')
	ORDER BY 4;

--Mostrar objetos del usuario
COL OBJECT_NAME FORMAT A25
COL OBJECT__TYPE FORMAT A12
COL OBJECT_ID   FORMAT 99,999	
SELECT OBJECT_NAME, OBJECT_TYPE, OBJECT_ID
	FROM USER_OBJECTS
	WHERE OBJECT_TYPE IN ('TABLE','INDEX', 'VIEW')
	ORDER BY 2,1;

--Mostrar índices
COL INDEX_NAME FORMAT A20
COL TABLE_NAME FORMAT A30
COL COLUMN_NAME FORMAT A15
COL COLUMN_POSITION FORMAT 999
COL COLUMN_LENGTH   FORMAT 999
select index_name, table_name,column_name, column_position, column_length
	char_length
	from user_ind_columns
	where table_name in ('LOTS1A','LOTS1B','LOTS2');

spool off

