----Crear usuario
--ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE; 
--CREATE USER mueble IDENTIFIED by mueble
--DEFAULT TABLESPACE users
--TEMPORARY TABLESPACE temp;
--GRANT CONNECT, RESOURCE TO mueble;
--GRANT UNLIMITED TABLESPACE TO mueble;
----Ajustes de sistema
set linesize 300
set pagesize 50
set feddback on
set colsep ' ||' 
set null s/dato

ALTER SESSION SET NLS_DATE_LANGUAGE  = 'ENGLISH';

clear screen
spool C:\Users\melis\OneDrive\Escritorio\Furniture.txt

--Borrar tablas
DROP TABLE TABLES CASCADE CONSTRAINTS;
DROP TABLE DESK CASCADE CONSTRAINTS;
DROP TABLE CHAIR CASCADE CONSTRAINTS;
DROP TABLE FURNITURE CASCADE CONSTRAINTS;

--Crear tablas
CREATE TABLE FURNITURE(
    FURNITURE_ID VARCHAR2(7) NOT NULL,
    EMPLOYEE_NUMBER NUMBER(5,0) NOT NULL,
    OFFICE_N0 NUMBER(4,0) NOT NULL,
    FURNITURE_TYPE VARCHAR2(10) NOT NULL
);

CREATE TABLE TABLES(
    FURNITURE_ID VARCHAR2(7) NOT NULL,
    EMPLOYEE_NUMBER NUMBER(5,0) NOT NULL,
    OFFICE_N0 NUMBER(4,0) NOT NULL,
    TABLE_SIZE NUMBER(4,2)
);

CREATE TABLE DESK(
    FURNITURE_ID VARCHAR2(7) NOT NULL,
    EMPLOYEE_NUMBER NUMBER(5,0) NOT NULL,
    OFFICE_N0 NUMBER(4,0) NOT NULL,
    DRAWERS NUMBER(2,0)
);

CREATE TABLE CHAIR(
    FURNITURE_ID VARCHAR2(7) NOT NULL,
    EMPLOYEE_NUMBER NUMBER(5,0) NOT NULL,
    OFFICE_N0 NUMBER(4,0) NOT NULL,
    CHAIR_TYPE VARCHAR2(10) NOT NULL
);

--RESTRICCIONES PK

ALTER TABLE FURNITURE
 ADD CONSTRAINT FURNITURE_FURNITURE_ID_PK PRIMARY KEY (FURNITURE_ID);
ALTER TABLE TABLES
 ADD CONSTRAINT TABLES_FURNITURE_ID_PK PRIMARY KEY (FURNITURE_ID);
ALTER TABLE DESK
 ADD CONSTRAINT DESK_FURNITURE_ID_PK PRIMARY KEY (FURNITURE_ID);
ALTER TABLE CHAIR
 ADD CONSTRAINT CHAIR_FURNITURE_ID_PK PRIMARY KEY (FURNITURE_ID);

--RESTRICCIONES FK

ALTER TABLE TABLES
 ADD CONSTRAINT TABLES_FURNITURE_ID_FK FOREIGN KEY (FURNITURE_ID) REFERENCES FURNITURE(FURNITURE_ID);

ALTER TABLE DESK
    ADD CONSTRAINT DESK_FURNITURE_ID_FK FOREIGN KEY (FURNITURE_ID) REFERENCES FURNITURE(FURNITURE_ID);

ALTER TABLE CHAIR
    ADD CONSTRAINT CHAIR_FURNITURE_ID_FK FOREIGN KEY (FURNITURE_ID) REFERENCES FURNITURE(FURNITURE_ID);

--RESCTRICCIONES CHECK

ALTER TABLE FURNITURE
    ADD CONSTRAINT FUNRTIURE_FURNITURE_ID_CK CHECK (REGEXP_LIKE(FURNITURE_ID,'([[:digit:]]{3})-([[:digit:]]{3})'));
    ADD CONSTRAINT FURNITURE_FURNITURE_TYPE_CK CHECK (FURNITURE_TYPE IN ('TABLE','DESK','CHAIR'));

ALTER TABLE TABLES
    ADD CONSTRAINT TABLES_TABLE_SIZE_CK CHECK (TABLE_SIZE BETWEEN 0.5 AND 2.5);

ALTER TABLE DESK
    ADD CONSTRAINT DESK_DRAWERS_CK CHECK (DRAWERS BETWEEN 1 AND 6);

ALTER TABLE CHAIR
    ADD CONSTRAINT CHAIR_CHAIR_TYPE_CK CHECK (CHAIR_TYPE IN ('GIRATORIA','RECLINABLE','EJECUTIVA'));


--INSERTAR DATOS

INSERT INTO FURNITURE VALUES ('123-456',36751,1221, 'TABLE');
INSERT INTO FURNITURE VALUES ('456-789',36752,1222, 'DESK');
INSERT INTO FURNITURE VALUES ('789-123',36753,1223, 'CHAIR');
INSERT INTO FURNITURE VALUES ('321-654',36754,1224, 'TABLE');
INSERT INTO FURNITURE VALUES ('654-987',36755,1225, 'DESK');
INSERT INTO FURNITURE VALUES ('987-321',36756,1226, 'CHAIR');
INSERT INTO FURNITURE VALUES ('741-852',36757,1227, 'TABLE');
INSERT INTO FURNITURE VALUES ('852-963',36758,1228, 'DESK');
INSERT INTO FURNITURE VALUES ('963-741',36759,1229, 'CHAIR');
INSERT INTO FURNITURE VALUES ('159-357',36760,1230, 'TABLE');


INSERT INTO TABLES VALUES ('123-456',36751,1221, 1.5);
INSERT INTO TABLES VALUES ('321-654',36754,1224, 0.7);
INSERT INTO TABLES VALUES ('741-852',36757,1227, 1.2);
INSERT INTO TABLES VALUES ('159-357',36760,1230, 2.5);

INSERT INTO DESK VALUES ('456-789',36752,1222, 3);
INSERT INTO DESK VALUES ('654-987',36755,1225, 4);
INSERT INTO DESK VALUES ('852-963',36758,1228, 6);

INSERT INTO CHAIR VALUES ('789-123',36753,1223, 'GIRATORIA');
INSERT INTO CHAIR VALUES ('987-321',36756,1226, 'RECLINABLE');
INSERT INTO CHAIR VALUES ('963-741',36759,1229, 'EJECUTIVA');

--CONSULTAS

--1.Mostrar los muebles que son mesas
SELECT * FROM FURNITURE WHERE FURNITURE_TYPE = 'TABLE';

--2.Mostrar los muebles que son escritorios
SELECT * FROM FURNITURE WHERE FURNITURE_TYPE = 'DESK';

--3.Mostrar los muebles que son sillas
SELECT * FROM FURNITURE WHERE FURNITURE_TYPE = 'CHAIR';

--MOSTRAR tablas

SELECT * FROM FURNITURE;
SELECT * FROM TABLES;
SELECT * FROM DESK;
SELECT * FROM CHAIR;


--MOSTRAR tablas con join y where y order by

SELECT * FROM FURNITURE F JOIN TABLES T ON F.FURNITURE_ID = T.FURNITURE_ID WHERE F.FURNITURE_TYPE = 'TABLE' ORDER BY T.TABLE_SIZE;

SELECT * FROM FURNITURE F JOIN DESK D ON F.FURNITURE_ID = D.FURNITURE_ID WHERE F.FURNITURE_TYPE = 'DESK' ORDER BY D.DRAWERS;

SELECT * FROM FURNITURE F JOIN CHAIR C ON F.FURNITURE_ID = C.FURNITURE_ID WHERE F.FURNITURE_TYPE = 'CHAIR' ORDER BY C.CHAIR_TYPE;


--COLUMNAS DE USUARIO
COL TABLE_NAME FORMAT A15
COL DATA_TYPE  FORMAT A15
COL DATA_SCALE FORMAT 999.99
COL NULLABLE   FORMAT A2
SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH,
	DATA_PRECISION,DATA_SCALE,NULLABLE
	FROM USER_TAB_COLUMNS 
	WHERE TABLE_NAME IN ( 'FURNITURE','TABLES','DESK','CHAIR')
	ORDER BY 1,2;

--MOSTRAR Restricciones
prompt USER CONSTRAINTS
COLUMN CONSTRAINT_NAME FORMAT A27
column table_name format a12
column owner format a9
select owner,table_name,constraint_name,constraint_type,
	deferrable,deferred
	from user_constraints
	where table_name IN ( 'FURNITURE','TABLES','DESK','CHAIR')
	ORDER BY 4;


--MOSTRAR INDICES

COL INDEX_NAME FORMAT A20
COL TABLE_NAME FORMAT A30
COL COLUMN_NAME FORMAT A15
COL COLUMN_POSITION FORMAT 999
COL COLUMN_LENGTH   FORMAT 999
select index_name, table_name,column_name, column_position, column_length
	char_length
	from user_ind_columns
	where table_name in ( 'FURNITURE','TABLES','DESK','CHAIR');

spool off





