
--Crear usuario
--ALTER SESSION SET "_ORACLE_SCRIPT"=TRUE; 
--CREATE USER atleta IDENTIFIED by atleta
--DEFAULT TABLESPACE users
--TEMPORARY TABLESPACE temp;
--GRANT CONNECT, RESOURCE TO atleta;
--GRANT UNLIMITED TABLESPACE TO atleta;

--Ajustes de sistema
set linesize 300
set pagesize 50
set feddback on
set colsep ' ||' 
set null s/dato

ALTER SESSION SET NLS_DATE_LANGUAGE  = 'ENGLISH';

clear screen
spool C:\Users\melis\OneDrive\Escritorio\Athlete.txt
--Borrar tablas
DROP TABLE FOOTBALL CASCADE CONSTRAINTS;
DROP TABLE GOLF CASCADE CONSTRAINTS;
DROP TABLE TENNIS CASCADE CONSTRAINTS;
DROP TABLE ATHLETE_SPORT CASCADE CONSTRAINTS;
DROP TABLE ATHLETE CASCADE CONSTRAINTS;


--Crear tablas

CREATE TABLE ATHLETE(
    SSNO VARCHAR2(11) NOT NULL,
    WEIGHT NUMBER(3,0) NOT NULL,
    NAME_A VARCHAR2(8) NOT NULL,
    GENDER VARCHAR(1) NOT NULL,
    HEIGHT NUMBER(3,2) NOT NULL
);

CREATE TABLE ATHLETE_SPORT(
    SSNO VARCHAR2(11) NOT NULL,
    SPORT VARCHAR2(8) NOT NULL
);

CREATE TABLE TENNIS(
    SSNO VARCHAR2(11) NOT NULL,
    STATE_RANKING NUMBER(2,0) NOT NULL
);

CREATE TABLE GOLF(
    SSNO VARCHAR2(11) NOT NULL,
    HANDICAP NUMBER(1,0) NOT NULL
);

CREATE TABLE FOOTBALL(
    SSNO VARCHAR2(11) NOT NULL,
    POSITION VARCHAR2(15)NOT NULL
);

--RESTRICCIONES PK
ALTER TABLE ATHLETE
ADD CONSTRAINT ATHLETE_PK PRIMARY KEY (SSNO);

ALTER TABLE ATHLETE_SPORT
ADD CONSTRAINT ATHLETE_SPORT_PK PRIMARY KEY (SSNO,SPORT);

ALTER TABLE TENNIS
ADD CONSTRAINT TENNIS_PK PRIMARY KEY (SSNO);

ALTER TABLE GOLF
ADD CONSTRAINT GOLF_PK PRIMARY KEY (SSNO);

ALTER TABLE FOOTBALL
ADD CONSTRAINT FOOTBALL_PK PRIMARY KEY (SSNO);

--RESTRICCIONES FK
ALTER TABLE ATHLETE_SPORT
ADD CONSTRAINT ATHLETE_SPORT_FK FOREIGN KEY (SSNO) REFERENCES ATHLETE (SSNO);

ALTER TABLE TENNIS
ADD CONSTRAINT TENNIS_FK FOREIGN KEY (SSNO) REFERENCES ATHLETE (SSNO);

ALTER TABLE GOLF
ADD CONSTRAINT GOLF_FK FOREIGN KEY (SSNO) REFERENCES ATHLETE (SSNO);

ALTER TABLE FOOTBALL
ADD CONSTRAINT FOOTBALL_FK FOREIGN KEY (SSNO) REFERENCES ATHLETE (SSNO);

--RESCTRICCIONES CHECK
ALTER TABLE ATHLETE
ADD CONSTRAINT ATHLETE_GENDER_CK CHECK (GENDER IN ('M','F'));
ADD CONSTRAINT ATHLETE_HEIGHT_CK CHECK (HEIGHT<7);

ALTER TABLE ATHLETE_SPORT
ADD CONSTRAINT ATHLETE_SPORT_CK CHECK (SPORT IN ('TENNIS','GOLF','FOOTBALL'));

ALTER TABLE TENNIS
ADD CONSTRAINT TENNIS_STATE_RANKING_CK CHECK (STATE_RANKING<50);

ALTER TABLE GOLF
ADD CONSTRAINT GOLF_HANDICAP_CK CHECK (HANDICAP<5);

ALTER TABLE FOOTBALL
ADD CONSTRAINT FOOTBALL_POSITION_CK CHECK (POSITION IN ('QUARTERBACK','TACKLE','FULL BACK'));


--INSERTAR DATOS
INSERT INTO ATHLETE VALUES ('239-92-0983', 140, 'Kumar', 'M',5.95);
INSERT INTO ATHLETE VALUES ('398-08-0928', 200, 'Kelvin', 'M',6.02);
INSERT INTO ATHLETE VALUES ('322-00-1234', 135, 'Sarah', 'F',5.6);
INSERT INTO ATHLETE VALUES ('873-97-9877', 165, 'Arjun', 'M',6.01);
INSERT INTO ATHLETE VALUES ('876-09-9873', 145, 'Deesha', 'F',5.5);

INSERT INTO ATHLETE_SPORT VALUES ('239-92-0983', 'GOLF');
INSERT INTO ATHLETE_SPORT VALUES ('398-08-0928', 'FOOTBALL');
INSERT INTO ATHLETE_SPORT VALUES ('322-00-1234', 'TENNIS');
INSERT INTO ATHLETE_SPORT VALUES ('873-97-9877', 'GOLF');
INSERT INTO ATHLETE_SPORT VALUES ('876-09-9873', 'TENNIS');
INSERT INTO ATHLETE_SPORT VALUES ('876-09-9873', 'GOLF');

INSERT INTO TENNIS VALUES ('322-00-1234', 23);
INSERT INTO TENNIS VALUES ('876-09-9873', 47);

INSERT INTO GOLF VALUES ('239-92-0983', 3);
INSERT INTO GOLF VALUES ('873-97-9877', 1);

INSERT INTO FOOTBALL VALUES ('398-08-0928', 'TACKLE');
INSERT INTO FOOTBALL VALUES ('239-92-0983', 'QUARTERBACK');
INSERT INTO FOOTBALL VALUES ('398-08-0928', 'FULL BACK');

--CONSULTAS
--1. Listar todos los atletas
SELECT * FROM ATHLETE;

--2. Listar todos los atletas que juegan golf
SELECT * FROM ATHLETE WHERE SSNO IN (SELECT SSNO FROM ATHLETE_SPORT WHERE SPORT = 'GOLF');

--3. Listar todos los atletas que juegan golf y su handicap, ordenados por handicap
SELECT * FROM ATHLETE WHERE SSNO IN (SELECT SSNO FROM ATHLETE_SPORT WHERE SPORT = 'GOLF') AND SSNO IN (SELECT SSNO FROM GOLF) ORDER BY SSNO;

--4. Listar todos los atletas que juegan TENNIS y su ranking, ordenados por ranking
SELECT * FROM ATHLETE WHERE SSNO IN (SELECT SSNO FROM ATHLETE_SPORT WHERE SPORT = 'TENNIS') AND SSNO IN (SELECT SSNO FROM TENNIS) ORDER BY SSNO;

--5. Listar todos los atletas que juegan FOOTBALL y su posicion, ordenados por posicion
SELECT * FROM ATHLETE WHERE SSNO IN (SELECT SSNO FROM ATHLETE_SPORT WHERE SPORT = 'FOOTBALL') AND SSNO IN (SELECT SSNO FROM FOOTBALL) ORDER BY SSNO;


--COLUMNAS DE USUARIO
COL TABLE_NAME FORMAT A15
COL DATA_TYPE  FORMAT A15
COL DATA_SCALE FORMAT 999.99
COL NULLABLE   FORMAT A2
SELECT TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_LENGTH,
	DATA_PRECISION,DATA_SCALE,NULLABLE
	FROM USER_TAB_COLUMNS 
	WHERE TABLE_NAME IN ( 'ATHLETE','ATHLETE_SPORT','TENNIS','GOLF','FOOTBALL')
	ORDER BY 1,2;

--MOSTRAR Restricciones
prompt USER CONSTRAINTS
COLUMN CONSTRAINT_NAME FORMAT A27
column table_name format a12
column owner format a9
select owner,table_name,constraint_name,constraint_type,
	deferrable,deferred
	from user_constraints
	where table_name IN ('ATHLETE','ATHLETE_SPORT','TENNIS','GOLF','FOOTBALL')
	ORDER BY 4;

--Mostrar objetos del usuario
COL OBJECT_NAME FORMAT A25
COL OBJECT__TYPE FORMAT A12
COL OBJECT_ID   FORMAT 99,999	
SELECT OBJECT_NAME, OBJECT_TYPE, OBJECT_ID
	FROM USER_OBJECTS
	WHERE OBJECT_TYPE IN ('TABLE','INDEX', 'VIEW')
	ORDER BY 2,1;

--MOSTRAR INDICES

COL INDEX_NAME FORMAT A20
COL TABLE_NAME FORMAT A30
COL COLUMN_NAME FORMAT A15
COL COLUMN_POSITION FORMAT 999
COL COLUMN_LENGTH   FORMAT 999
select index_name, table_name,column_name, column_position, column_length
	char_length
	from user_ind_columns
	where table_name in ( 'ATHLETE','ATHLETE_SPORT','TENNIS','GOLF','FOOTBALL');

spool off




